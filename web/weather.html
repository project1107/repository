<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>本地天气</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            accent: '#FF7D00',
            dark: '#1D2129',
            light: '#F2F3F5'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .weather-card {
        @apply bg-white/10 backdrop-blur-lg rounded-2xl shadow-lg p-6 transition-all duration-300;
      }
      .gradient-bg {
        @apply bg-gradient-to-br from-primary/20 to-secondary/20;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .hover-scale {
        @apply hover:scale-105 transition-transform duration-300;
      }
    }
  </style>
</head>

<body class="font-inter min-h-screen gradient-bg text-dark flex flex-col">
  <!-- 顶部导航 -->
  <header class="w-full py-4 px-6 md:px-12 flex justify-between items-center bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
    <div class="flex items-center gap-2">
      <i class="fa fa-cloud text-primary text-2xl"></i>
      <h1 class="text-xl md:text-2xl font-bold text-primary">本地天气</h1>
    </div>
    <div class="flex items-center gap-4">
      <button id="unitToggle" class="flex items-center gap-1 px-3 py-1.5 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors">
        <span id="unitText">°C</span>
        <i class="fa fa-exchange text-xs"></i>
      </button>
      <button id="refreshBtn" class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary/20 transition-colors">
        <i class="fa fa-refresh"></i>
      </button>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-1 w-full max-w-6xl mx-auto p-4 md:p-8 flex flex-col gap-6">
    <!-- 位置和状态信息 -->
    <section class="weather-card">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h2 id="location" class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-shadow">获取位置中...</h2>
          <p id="lastUpdated" class="text-gray-500 text-sm">最后更新：--</p>
        </div>
        <div id="locationStatus" class="flex items-center gap-2 text-gray-600">
          <i class="fa fa-spinner fa-spin"></i>
          <span>正在获取您的位置...</span>
        </div>
      </div>
    </section>

    <!-- 当前天气 -->
    <section class="weather-card grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="flex flex-col justify-center items-center md:items-start">
        <div class="flex items-center gap-4 mb-2">
          <i id="currentWeatherIcon" class="fa fa-cloud text-5xl text-primary"></i>
          <span id="currentWeatherDesc" class="text-xl font-medium">--</span>
        </div>
        <div class="flex items-center gap-2">
          <span id="currentTemp" class="text-[clamp(2.5rem,5vw,4rem)] font-bold leading-none">--</span>
          <div class="flex flex-col justify-end pb-2">
            <span id="tempRange" class="text-gray-500">--</span>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-tint"></i>
            <span>湿度</span>
          </div>
          <p id="humidity" class="text-xl font-semibold">--</p>
        </div>
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-wind"></i>
            <span>风速</span>
          </div>
          <p id="windSpeed" class="text-xl font-semibold">--</p>
        </div>
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-sun-o"></i>
            <span>紫外线</span>
          </div>
          <p id="uvIndex" class="text-xl font-semibold">--</p>
        </div>
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-tachometer"></i>
            <span>气压</span>
          </div>
          <p id="pressure" class="text-xl font-semibold">--</p>
        </div>
      </div>
    </section>

    <!-- 日出日落信息 -->
    <section class="weather-card">
      <h3 class="text-lg font-semibold mb-4">日出日落</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="flex items-center gap-4 bg-white/20 rounded-xl p-4 hover-scale">
          <div class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent">
            <i class="fa fa-sun-o text-xl"></i>
          </div>
          <div>
            <p class="text-gray-500">日出时间</p>
            <p id="sunrise" class="text-xl font-semibold">--</p>
          </div>
        </div>
        <div class="flex items-center gap-4 bg-white/20 rounded-xl p-4 hover-scale">
          <div class="w-12 h-12 rounded-full bg-dark/20 flex items-center justify-center text-dark">
            <i class="fa fa-moon-o text-xl"></i>
          </div>
          <div>
            <p class="text-gray-500">日落时间</p>
            <p id="sunset" class="text-xl font-semibold">--</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 未来天气预报 -->
    <section class="weather-card">
      <h3 class="text-lg font-semibold mb-4">未来天气预报</h3>
      <div id="forecastContainer" class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <!-- 未来天气预报将通过JS动态生成 -->
        <div class="col-span-2 md:col-span-5 flex justify-center items-center py-8 text-gray-500">
          <i class="fa fa-spinner fa-spin mr-2"></i>
          <span>加载预报数据中...</span>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="w-full py-4 px-6 text-center text-gray-500 text-sm">
    <p>数据来源: OpenWeather API | 使用HTML5地理定位</p>
  </footer>

  <!-- 错误提示弹窗 -->
  <div id="errorModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-500">
          <i class="fa fa-exclamation-triangle"></i>
        </div>
        <h3 class="text-xl font-bold">获取天气失败</h3>
      </div>
      <p id="errorMessage" class="text-gray-600 mb-6">无法获取天气数据，请稍后重试。</p>
      <button id="closeErrorBtn" class="w-full py-3 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors">
        关闭
      </button>
    </div><!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>本地天气</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            accent: '#FF7D00',
            dark: '#1D2129',
            light: '#F2F3F5'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .weather-card {
        @apply bg-white/10 backdrop-blur-lg rounded-2xl shadow-lg p-6 transition-all duration-300;
      }
      .gradient-bg {
        @apply bg-gradient-to-br from-primary/20 to-secondary/20;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .hover-scale {
        @apply hover:scale-105 transition-transform duration-300;
      }
    }
  </style>
</head>

<body class="font-inter min-h-screen gradient-bg text-dark flex flex-col">
  <!-- 顶部导航 -->
  <header class="w-full py-4 px-6 md:px-12 flex justify-between items-center bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
    <div class="flex items-center gap-2">
      <i class="fa fa-cloud text-primary text-2xl"></i>
      <h1 class="text-xl md:text-2xl font-bold text-primary">本地天气</h1>
    </div>
    <div class="flex items-center gap-4">
      <button id="unitToggle" class="flex items-center gap-1 px-3 py-1.5 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors">
        <span id="unitText">°C</span>
        <i class="fa fa-exchange text-xs"></i>
      </button>
      <button id="refreshBtn" class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary/20 transition-colors">
        <i class="fa fa-refresh"></i>
      </button>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-1 w-full max-w-6xl mx-auto p-4 md:p-8 flex flex-col gap-6">
    <!-- 位置和状态信息 -->
    <section class="weather-card">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h2 id="location" class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-shadow">获取位置中...</h2>
          <p id="lastUpdated" class="text-gray-500 text-sm">最后更新：--</p>
        </div>
        <div id="locationStatus" class="flex items-center gap-2 text-gray-600">
          <i class="fa fa-spinner fa-spin"></i>
          <span>正在获取您的位置...</span>
        </div>
      </div>
    </section>

    <!-- 当前天气 -->
    <section class="weather-card grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="flex flex-col justify-center items-center md:items-start">
        <div class="flex items-center gap-4 mb-2">
          <i id="currentWeatherIcon" class="fa fa-cloud text-5xl text-primary"></i>
          <span id="currentWeatherDesc" class="text-xl font-medium">--</span>
        </div>
        <div class="flex items-center gap-2">
          <span id="currentTemp" class="text-[clamp(2.5rem,5vw,4rem)] font-bold leading-none">--</span>
          <div class="flex flex-col justify-end pb-2">
            <span id="tempRange" class="text-gray-500">--</span>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-tint"></i>
            <span>湿度</span>
          </div>
          <p id="humidity" class="text-xl font-semibold">--</p>
        </div>
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-wind"></i>
            <span>风速</span>
          </div>
          <p id="windSpeed" class="text-xl font-semibold">--</p>
        </div>
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-sun-o"></i>
            <span>紫外线</span>
          </div>
          <p id="uvIndex" class="text-xl font-semibold">--</p>
        </div>
        <div class="bg-white/20 rounded-xl p-4 hover-scale">
          <div class="flex items-center gap-2 text-gray-500 mb-1">
            <i class="fa fa-tachometer"></i>
            <span>气压</span>
          </div>
          <p id="pressure" class="text-xl font-semibold">--</p>
        </div>
      </div>
    </section>

    <!-- 日出日落信息 -->
    <section class="weather-card">
      <h3 class="text-lg font-semibold mb-4">日出日落</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="flex items-center gap-4 bg-white/20 rounded-xl p-4 hover-scale">
          <div class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent">
            <i class="fa fa-sun-o text-xl"></i>
          </div>
          <div>
            <p class="text-gray-500">日出时间</p>
            <p id="sunrise" class="text-xl font-semibold">--</p>
          </div>
        </div>
        <div class="flex items-center gap-4 bg-white/20 rounded-xl p-4 hover-scale">
          <div class="w-12 h-12 rounded-full bg-dark/20 flex items-center justify-center text-dark">
            <i class="fa fa-moon-o text-xl"></i>
          </div>
          <div>
            <p class="text-gray-500">日落时间</p>
            <p id="sunset" class="text-xl font-semibold">--</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 未来天气预报 -->
    <section class="weather-card">
      <h3 class="text-lg font-semibold mb-4">未来天气预报</h3>
      <div id="forecastContainer" class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <!-- 未来天气预报将通过JS动态生成 -->
        <div class="col-span-2 md:col-span-5 flex justify-center items-center py-8 text-gray-500">
          <i class="fa fa-spinner fa-spin mr-2"></i>
          <span>加载预报数据中...</span>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="w-full py-4 px-6 text-center text-gray-500 text-sm">
    <p>数据来源: 和风天气API | 使用HTML5地理定位</p>
  </footer>

  <!-- 错误提示弹窗 -->
  <div id="errorModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-500">
          <i class="fa fa-exclamation-triangle"></i>
        </div>
        <h3 class="text-xl font-bold">获取天气失败</h3>
      </div>
      <p id="errorMessage" class="text-gray-600 mb-6">无法获取天气数据，请稍后重试。</p>
      <button id="closeErrorBtn" class="w-full py-3 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors">
        关闭
      </button>
    </div>
  </div>

  <script>
    // 全局变量 - 和风天气API
    let isCelsius = true;
    let apiKey = '8eacc656447445278e5e92c2b61d714c'; // 请替换为您的和风天气API密钥
    let currentWeatherData = null;
    
    // DOM元素
    const locationEl = document.getElementById('location');
    const locationStatusEl = document.getElementById('locationStatus');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const currentWeatherIconEl = document.getElementById('currentWeatherIcon');
    const currentWeatherDescEl = document.getElementById('currentWeatherDesc');
    const currentTempEl = document.getElementById('currentTemp');
    const tempRangeEl = document.getElementById('tempRange');
    const humidityEl = document.getElementById('humidity');
    const windSpeedEl = document.getElementById('windSpeed');
    const uvIndexEl = document.getElementById('uvIndex');
    const pressureEl = document.getElementById('pressure');
    const sunriseEl = document.getElementById('sunrise');
    const sunsetEl = document.getElementById('sunset');
    const forecastContainerEl = document.getElementById('forecastContainer');
    const unitToggleBtn = document.getElementById('unitToggle');
    const unitTextEl = document.getElementById('unitText');
    const refreshBtn = document.getElementById('refreshBtn');
    const errorModalEl = document.getElementById('errorModal');
    const errorMessageEl = document.getElementById('errorMessage');
    const closeErrorBtn = document.getElementById('closeErrorBtn');
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 事件监听
      unitToggleBtn.addEventListener('click', toggleUnit);
      refreshBtn.addEventListener('click', refreshWeather);
      closeErrorBtn.addEventListener('click', () => errorModalEl.classList.add('hidden'));
      
      // 开始获取天气
      getLocationAndWeather();
    });
    
    // 获取位置并加载天气
    function getLocationAndWeather() {
      if (!navigator.geolocation) {
        showError('您的浏览器不支持地理位置功能，无法获取天气信息。');
        return;
      }
      
      locationStatusEl.innerHTML = '<i class="fa fa-spinner fa-spin"></i><span>正在获取您的位置...</span>';
      
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          fetchWeatherData(lat, lon);
        },
        (error) => {
          console.error('获取位置失败:', error);
          switch(error.code) {
            case 1:
              showError('请允许位置权限以获取本地天气。');
              break;
            case 2:
              showError('无法获取位置信息，请稍后重试。');
              break;
            case 3:
              showError('获取位置超时，请稍后重试。');
              break;
            default:
              showError('获取位置失败，请稍后重试。');
          }
          locationStatusEl.innerHTML = '<i class="fa fa-exclamation-circle text-red-500"></i><span>获取位置失败</span>';
        }
      );
    }
    
    // 获取天气数据（使用和风天气API）
    function fetchWeatherData(lat, lon) {
      locationStatusEl.innerHTML = '<i class="fa fa-cloud-download text-primary"></i><span>正在获取天气数据...</span>';
      
      // 和风天气API URL（实时天气+3天预报）
      const url = `https://devapi.qweather.com/v7/weather/now?location=${lon},${lat}&key=${apiKey}`;
      const forecastUrl = `https://devapi.qweather.com/v7/weather/3d?location=${lon},${lat}&key=${apiKey}`;
      const sunriseUrl = `https://devapi.qweather.com/v7/astronomy/sun?location=${lon},${lat}&date=${getCurrentDate()}&key=${apiKey}`;
      
      // 并行请求所有需要的天气数据
      Promise.all([
        fetch(url).then(res => res.json()),
        fetch(forecastUrl).then(res => res.json()),
        fetch(sunriseUrl).then(res => res.json())
      ])
      .then(([nowData, forecastData, sunriseData]) => {
        // 检查API返回状态
        if (nowData.code !== '200' || forecastData.code !== '200' || sunriseData.code !== '200') {
          throw new Error(`API错误: ${nowData.code} - ${nowData.msg || '获取实时天气失败'}`);
        }
        
        // 整合数据
        currentWeatherData = {
          now: nowData.now,
          forecast: forecastData.daily,
          sunrise: sunriseData.sunrise,
          sunset: sunriseData.sunset,
          location: { lat, lon, name: nowData.location.name, country: nowData.location.country }
        };
        
        updateWeatherUI(currentWeatherData);
        locationStatusEl.innerHTML = '<i class="fa fa-check-circle text-green-500"></i><span>数据更新成功</span>';
      })
      .catch(error => {
        console.error('获取天气数据失败:', error);
        showError(`获取天气数据失败: ${error.message || '请检查API密钥是否有效'}`);
        locationStatusEl.innerHTML = '<i class="fa fa-exclamation-circle text-red-500"></i><span>获取天气失败</span>';
      });
    }
    
    // 更新天气UI
    function updateWeatherUI(data) {
      // 更新位置信息
      locationEl.textContent = `${data.location.name}, ${data.location.country}`;
      
      // 更新最后更新时间
      const now = new Date();
      lastUpdatedEl.textContent = `最后更新：${now.toLocaleString()}`;
      
      // 当前天气
      const current = data.now;
      currentWeatherDescEl.textContent = current.text;
      currentWeatherIconEl.className = getWeatherIconClass(current.icon, current.text);
      
      // 温度显示（和风天气默认返回摄氏度）
      updateTemperatureDisplay(current, data.forecast[0]);
      
      // 其他天气信息
      humidityEl.textContent = `${current.humidity}%`;
      windSpeedEl.textContent = `${current.windSpeed} km/h`;
      uvIndexEl.textContent = `${current.uvIndex} (${getUvIndexDescription(current.uvIndex)})`;
      pressureEl.textContent = `${current.pressure} hPa`;
      
      // 日出日落时间
      sunriseEl.textContent = data.sunrise;
      sunsetEl.textContent = data.sunset;
      
      // 未来天气预报（取未来3天，排除今天）
      updateForecastUI(data.forecast.slice(1));
      
      // 根据天气状况更新背景
      const isDay = isDayTime(data.sunrise, data.sunset);
      updateBackground(current.text, isDay);
    }
    
    // 更新温度显示
    function updateTemperatureDisplay(current, daily) {
      // 和风天气默认返回摄氏度，这里保留单位切换功能
      if (isCelsius) {
        currentTempEl.textContent = `${current.temp}°C`;
        tempRangeEl.textContent = `最高: ${daily.high}°C 最低: ${daily.low}°C`;
      } else {
        const tempF = Math.round(parseInt(current.temp) * 9/5 + 32);
        const maxF = Math.round(parseInt(daily.high) * 9/5 + 32);
        const minF = Math.round(parseInt(daily.low) * 9/5 + 32);
        currentTempEl.textContent = `${tempF}°F`;
        tempRangeEl.textContent = `最高: ${maxF}°F 最低: ${minF}°F`;
      }
    }
    
    // 更新未来天气预报UI
    function updateForecastUI(forecastData) {
      forecastContainerEl.innerHTML = '';
      
      forecastData.forEach(day => {
        const dayEl = document.createElement('div');
        dayEl.className = 'bg-white/20 rounded-xl p-4 text-center hover-scale';
        
        // 格式化日期为星期
        const date = new Date(day.fxDate);
        const dayName = getDayName(date.getDay());
        
        let tempDisplay;
        if (isCelsius) {
          tempDisplay = `${day.high}° / ${day.low}°C`;
        } else {
          const maxF = Math.round(parseInt(day.high) * 9/5 + 32);
          const minF = Math.round(parseInt(day.low) * 9/5 + 32);
          tempDisplay = `${maxF}° / ${minF}°F`;
        }
        
        dayEl.innerHTML = `
          <p class="font-medium">${dayName}</p>
          <i class="${getWeatherIconClass(day.iconDay, day.textDay)} text-2xl my-2"></i>
          <p class="text-sm text-gray-500">${day.textDay}</p>
          <p class="font-semibold mt-1">${tempDisplay}</p>
        `;
        
        forecastContainerEl.appendChild(dayEl);
      });
    }
    
    // 切换温度单位
    function toggleUnit() {
      if (!currentWeatherData) return;
      
      isCelsius = !isCelsius;
      unitTextEl.textContent = isCelsius ? '°C' : '°F';
      
      // 更新温度显示
      updateTemperatureDisplay(currentWeatherData.now, currentWeatherData.forecast[0]);
      
      // 更新预报温度
      updateForecastUI(currentWeatherData.forecast.slice(1));
    }
    
    // 刷新天气数据
    function refreshWeather() {
      refreshBtn.classList.add('animate-spin');
      if (currentWeatherData) {
        fetchWeatherData(currentWeatherData.location.lat, currentWeatherData.location.lon)
          .finally(() => {
            refreshBtn.classList.remove('animate-spin');
          });
      } else {
        getLocationAndWeather()
          .finally(() => {
            refreshBtn.classList.remove('animate-spin');
          });
      }
    }
    
    // 显示错误信息
    function showError(message) {
      errorMessageEl.textContent = message;
      errorModalEl.classList.remove('hidden');
    }
    
    // 根据天气状况获取图标类名（和风天气图标映射）
    function getWeatherIconClass(iconCode, weatherText) {
      // 和风天气图标码映射到FontAwesome图标
      const iconMap = {
        '100': 'fa-sun-o text-accent',       // 晴
        '101': 'fa-cloud-sun-o text-accent', // 多云
        '102': 'fa-cloud text-gray-400',     // 少云
        '103': 'fa-cloud text-gray-400',     // 晴间多云
        '104': 'fa-cloud text-gray-500',     // 阴
        '200': 'fa-bolt text-yellow-500',    // 雷阵雨
        '201': 'fa-bolt text-yellow-500',    // 雷阵雨并伴有冰雹
        '202': 'fa-bolt text-yellow-500',    // 雷暴
        '203': 'fa-bolt text-yellow-500',    // 强雷暴
        '204': 'fa-bolt text-yellow-500',    // 极端雷暴
        '205': 'fa-tint text-blue-400',      // 阵雨
        '206': 'fa-tint text-blue-400',      // 强阵雨
        '207': 'fa-tint text-blue-400',      // 暴雨
        '208': 'fa-tint text-blue-400',      // 极端暴雨
        '209': 'fa-tint text-blue-400',      // 大暴雨
        '210': 'fa-tint text-blue-400',      // 特大暴雨
        '211': 'fa-tint text-blue-400',      // 冻雨
        '300': 'fa-snowflake-o text-blue-100',// 小雪
        '301': 'fa-snowflake-o text-blue-100',// 中雪
        '302': 'fa-snowflake-o text-blue-100',// 大雪
        '303': 'fa-snowflake-o text-blue-100',// 暴雪
        '304': 'fa-snowflake-o text-blue-100',// 极端暴雪
        '305': 'fa-snowflake-o text-blue-100',// 阵雪
        '400': 'fa-tint text-blue-400',      // 小雨
        '401': 'fa-tint text-blue-400',      // 中雨
        '402': 'fa-tint text-blue-400',      // 大雨
        '403': 'fa-tint text-blue-400',      // 极端大雨
        '404': 'fa-tint text-blue-400',      // 毛毛雨/细雨
        '405': 'fa-tint text-blue-400',      // 暴雨
        '406': 'fa-tint text-blue-400',      // 大暴雨
        '407': 'fa-tint text-blue-400',      // 特大暴雨
        '500': 'fa-smog text-gray-400',      // 雾
        '501': 'fa-smog text-gray-400',      // 轻雾
        '502': 'fa-smog text-gray-400',      // 中度雾
        '503': 'fa-smog text-gray-400',      // 重度雾
        '504': 'fa-smog text-gray-400',      // 极端雾
        '507': 'fa-smog text-gray-400',      // 烟雾
        '508': 'fa-smog text-gray-400',      // 霾
      };
      
      return `fa ${iconMap[iconCode] || 'fa-question-circle text-gray-400'}`;
    }
    
    // 根据时间和天气更新背景
    function updateBackground(weatherText, isDay) {
      const body = document.body;
      
      // 先移除所有天气相关类
      body.classList.remove(
        'from-blue-300/30', 'to-blue-100/30',
        'from-slate-800/30', 'to-slate-900/30',
        'from-gray-300/30', 'to-gray-100/30',
        'from-blue-500/30', 'to-blue-300/30',
        'from-slate-700/30', 'to-slate-500/30',
        'from-blue-100/30', 'to-gray-100/30',
        'from-gray-400/30', 'to-gray-200/30'
      );
      
      // 根据天气和时间设置背景
      if (weatherText.includes('晴')) {
        if (isDay) {
          body.classList.add('from-blue-300/30', 'to-blue-100/30');
        } else {
          body.classList.add('from-slate-800/30', 'to-slate-900/30');
        }
      } else if (weatherText.includes('云') || weatherText.includes('阴')) {
        body.classList.add('from-gray-300/30', 'to-gray-100/30');
      } else if (weatherText.includes('雨') || weatherText.includes('雷')) {
        body.classList.add('from-blue-500/30', 'to-blue-300/30');
      } else if (weatherText.includes('雪')) {
        body.classList.add('from-blue-100/30', 'to-gray-100/30');
      } else if (weatherText.includes('雾') || weatherText.includes('霾') || weatherText.includes('烟')) {
        body.classList.add('from-gray-400/30', 'to-gray-200/30');
      }
    }
    
    // 工具函数：判断当前是否为白天
    function isDayTime(sunrise, sunset) {
      const now = new Date();
      const currentTime = now.getHours() * 60 + now.getMinutes();
      
      // 解析日出日落时间（格式：HH:MM）
      const [sunriseH, sunriseM] = sunrise.split(':').map(Number);
      const [sunsetH, sunsetM] = sunset.split(':').map(Number);
      
      const sunriseTime = sunriseH * 60 + sunriseM;
      const sunsetTime = sunsetH * 60 + sunsetM;
      
      return currentTime >= sunriseTime && currentTime <= sunsetTime;
    }
    
    // 工具函数：获取当前日期（YYYYMMDD）
    function getCurrentDate() {
      const date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}${month}${day}`;
    }
    
    // 工具函数：获取星期几
    function getDayName(dayIndex) {
      const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
      return days[dayIndex];
    }
    
    // 工具函数：获取紫外线指数描述
    function getUvIndexDescription(index) {
      if (index <= 2) return '低';
      if (index <= 5) return '中等';
      if (index <= 7) return '高';
      if (index <= 10) return '很高';
      return '极高';
    }
  </script>
</body>
</html>

  </div>

  <script>
    // 全局变量
    let isCelsius = true;
    let apiKey = 'YOUR_API_KEY'; // 请替换为您的OpenWeather API密钥
    let currentWeatherData = null;
    
    // DOM元素
    const locationEl = document.getElementById('location');
    const locationStatusEl = document.getElementById('locationStatus');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const currentWeatherIconEl = document.getElementById('currentWeatherIcon');
    const currentWeatherDescEl = document.getElementById('currentWeatherDesc');
    const currentTempEl = document.getElementById('currentTemp');
    const tempRangeEl = document.getElementById('tempRange');
    const humidityEl = document.getElementById('humidity');
    const windSpeedEl = document.getElementById('windSpeed');
    const uvIndexEl = document.getElementById('uvIndex');
    const pressureEl = document.getElementById('pressure');
    const sunriseEl = document.getElementById('sunrise');
    const sunsetEl = document.getElementById('sunset');
    const forecastContainerEl = document.getElementById('forecastContainer');
    const unitToggleBtn = document.getElementById('unitToggle');
    const unitTextEl = document.getElementById('unitText');
    const refreshBtn = document.getElementById('refreshBtn');
    const errorModalEl = document.getElementById('errorModal');
    const errorMessageEl = document.getElementById('errorMessage');
    const closeErrorBtn = document.getElementById('closeErrorBtn');
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 事件监听
      unitToggleBtn.addEventListener('click', toggleUnit);
      refreshBtn.addEventListener('click', refreshWeather);
      closeErrorBtn.addEventListener('click', () => errorModalEl.classList.add('hidden'));
      
      // 开始获取天气
      getLocationAndWeather();
    });
    
    // 获取位置并加载天气
    function getLocationAndWeather() {
      if (!navigator.geolocation) {
        showError('您的浏览器不支持地理位置功能，无法获取天气信息。');
        return;
      }
      
      locationStatusEl.innerHTML = '<i class="fa fa-spinner fa-spin"></i><span>正在获取您的位置...</span>';
      
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          fetchWeatherData(lat, lon);
        },
        (error) => {
          console.error('获取位置失败:', error);
          switch(error.code) {
            case 1:
              showError('请允许位置权限以获取本地天气。');
              break;
            case 2:
              showError('无法获取位置信息，请稍后重试。');
              break;
            case 3:
              showError('获取位置超时，请稍后重试。');
              break;
            default:
              showError('获取位置失败，请稍后重试。');
          }
          locationStatusEl.innerHTML = '<i class="fa fa-exclamation-circle text-red-500"></i><span>获取位置失败</span>';
        }
      );
    }
    
    // 获取天气数据
    function fetchWeatherData(lat, lon) {
      locationStatusEl.innerHTML = '<i class="fa fa-cloud-download text-primary"></i><span>正在获取天气数据...</span>';
      
      // 构建API URL
      const url = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely&units=metric&appid=${apiKey}`;
      
      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP错误，状态码: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          currentWeatherData = data;
          updateWeatherUI(data);
          locationStatusEl.innerHTML = '<i class="fa fa-check-circle text-green-500"></i><span>数据更新成功</span>';
        })
        .catch(error => {
          console.error('获取天气数据失败:', error);
          showError('获取天气数据失败，请检查API密钥是否有效或稍后重试。');
          locationStatusEl.innerHTML = '<i class="fa fa-exclamation-circle text-red-500"></i><span>获取天气失败</span>';
        });
    }
    
    // 更新天气UI
    function updateWeatherUI(data) {
      // 更新位置信息
      fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${data.lat}&lon=${data.lon}&limit=1&appid=${apiKey}`)
        .then(response => response.json())
        .then(geoData => {
          if (geoData && geoData.length > 0) {
            const locationName = `${geoData[0].name}, ${geoData[0].country}`;
            locationEl.textContent = locationName;
          } else {
            locationEl.textContent = `纬度: ${data.lat.toFixed(2)}, 经度: ${data.lon.toFixed(2)}`;
          }
        })
        .catch(error => {
          console.error('获取位置名称失败:', error);
          locationEl.textContent = `纬度: ${data.lat.toFixed(2)}, 经度: ${data.lon.toFixed(2)}`;
        });
      
      // 更新最后更新时间
      const now = new Date();
      lastUpdatedEl.textContent = `最后更新：${now.toLocaleString()}`;
      
      // 当前天气
      const current = data.current;
      currentWeatherDescEl.textContent = capitalizeFirstLetter(current.weather[0].description);
      currentWeatherIconEl.className = getWeatherIconClass(current.weather[0].icon, current.weather[0].main);
      
      // 温度显示（根据单位切换）
      updateTemperatureDisplay(current, data.daily[0]);
      
      // 其他天气信息
      humidityEl.textContent = `${current.humidity}%`;
      windSpeedEl.textContent = `${current.wind_speed} m/s`;
      uvIndexEl.textContent = `${current.uvi} (${getUvIndexDescription(current.uvi)})`;
      pressureEl.textContent = `${current.pressure} hPa`;
      
      // 日出日落时间
      sunriseEl.textContent = formatUnixTime(current.sunrise);
      sunsetEl.textContent = formatUnixTime(current.sunset);
      
      // 未来天气预报
      updateForecastUI(data.daily.slice(1, 6)); // 未来5天
      
      // 根据天气状况更新背景
      updateBackground(current.weather[0].main, current.dt, current.sunrise, current.sunset);
    }
    
    // 更新温度显示
    function updateTemperatureDisplay(current, daily) {
      if (isCelsius) {
        currentTempEl.textContent = `${Math.round(current.temp)}°C`;
        tempRangeEl.textContent = `最高: ${Math.round(daily.temp.max)}°C 最低: ${Math.round(daily.temp.min)}°C`;
      } else {
        const tempF = Math.round(current.temp * 9/5 + 32);
        const maxF = Math.round(daily.temp.max * 9/5 + 32);
        const minF = Math.round(daily.temp.min * 9/5 + 32);
        currentTempEl.textContent = `${tempF}°F`;
        tempRangeEl.textContent = `最高: ${maxF}°F 最低: ${minF}°F`;
      }
    }
    
    // 更新未来天气预报UI
    function updateForecastUI(forecastData) {
      forecastContainerEl.innerHTML = '';
      
      forecastData.forEach(day => {
        const dayEl = document.createElement('div');
        dayEl.className = 'bg-white/20 rounded-xl p-4 text-center hover-scale';
        
        const date = new Date(day.dt * 1000);
        const dayName = getDayName(date.getDay());
        
        let tempDisplay;
        if (isCelsius) {
          tempDisplay = `${Math.round(day.temp.max)}° / ${Math.round(day.temp.min)}°C`;
        } else {
          const maxF = Math.round(day.temp.max * 9/5 + 32);
          const minF = Math.round(day.temp.min * 9/5 + 32);
          tempDisplay = `${maxF}° / ${minF}°F`;
        }
        
        dayEl.innerHTML = `
          <p class="font-medium">${dayName}</p>
          <i class="${getWeatherIconClass(day.weather[0].icon, day.weather[0].main)} text-2xl my-2"></i>
          <p class="text-sm text-gray-500">${capitalizeFirstLetter(day.weather[0].description)}</p>
          <p class="font-semibold mt-1">${tempDisplay}</p>
        `;
        
        forecastContainerEl.appendChild(dayEl);
      });
    }
    
    // 切换温度单位
    function toggleUnit() {
      if (!currentWeatherData) return;
      
      isCelsius = !isCelsius;
      unitTextEl.textContent = isCelsius ? '°C' : '°F';
      
      // 更新温度显示
      updateTemperatureDisplay(currentWeatherData.current, currentWeatherData.daily[0]);
      
      // 更新预报温度
      updateForecastUI(currentWeatherData.daily.slice(1, 6));
    }
    
    // 刷新天气数据
    function refreshWeather() {
      refreshBtn.classList.add('animate-spin');
      if (currentWeatherData) {
        fetchWeatherData(currentWeatherData.lat, currentWeatherData.lon)
          .finally(() => {
            refreshBtn.classList.remove('animate-spin');
          });
      } else {
        getLocationAndWeather()
          .finally(() => {
            refreshBtn.classList.remove('animate-spin');
          });
      }
    }
    
    // 显示错误信息
    function showError(message) {
      errorMessageEl.textContent = message;
      errorModalEl.classList.remove('hidden');
    }
    
    // 根据天气状况获取图标类名
    function getWeatherIconClass(iconCode, weatherMain) {
      const iconMap = {
        '01d': 'fa-sun-o text-accent',
        '01n': 'fa-moon-o text-gray-300',
        '02d': 'fa-cloud-sun-o text-accent',
        '02n': 'fa-cloud-moon-o text-gray-300',
        '03d': 'fa-cloud text-gray-400',
        '03n': 'fa-cloud text-gray-400',
        '04d': 'fa-cloud text-gray-500',
        '04n': 'fa-cloud text-gray-500',
        '09d': 'fa-tint text-blue-400',
        '09n': 'fa-tint text-blue-400',
        '10d': 'fa-cloud-sun-rain text-blue-400',
        '10n': 'fa-cloud-moon-rain text-blue-400',
        '11d': 'fa-bolt text-yellow-500',
        '11n': 'fa-bolt text-yellow-500',
        '13d': 'fa-snowflake-o text-blue-100',
        '13n': 'fa-snowflake-o text-blue-100',
        '50d': 'fa-smog text-gray-400',
        '50n': 'fa-smog text-gray-400'
      };
      
      return `fa ${iconMap[iconCode] || 'fa-question-circle text-gray-400'}`;
    }
    
    // 根据时间更新背景
    function updateBackground(weatherMain, currentTime, sunrise, sunset) {
      const isDay = currentTime > sunrise && currentTime < sunset;
      const body = document.body;
      
      // 先移除所有天气相关类
      body.classList.remove(
        'bg-sunny-day', 'bg-clear-night', 'bg-cloudy', 
        'bg-rainy', 'bg-thunder', 'bg-snowy', 'bg-foggy'
      );
      
      // 根据天气和时间设置背景
      if (weatherMain === 'Clear') {
        if (isDay) {
          body.classList.add('gradient-bg', 'from-blue-300/30', 'to-blue-100/30');
        } else {
          body.classList.add('gradient-bg', 'from-slate-800/30', 'to-slate-900/30');
        }
      } else if (weatherMain === 'Clouds') {
        body.classList.add('gradient-bg', 'from-gray-300/30', 'to-gray-100/30');
      } else if (['Rain', 'Drizzle'].includes(weatherMain)) {
        body.classList.add('gradient-bg', 'from-blue-500/30', 'to-blue-300/30');
      } else if (weatherMain === 'Thunderstorm') {
        body.classList.add('gradient-bg', 'from-slate-700/30', 'to-slate-500/30');
      } else if (weatherMain === 'Snow') {
        body.classList.add('gradient-bg', 'from-blue-100/30', 'to-gray-100/30');
      } else if (weatherMain === 'Mist' || weatherMain === 'Fog') {
        body.classList.add('gradient-bg', 'from-gray-400/30', 'to-gray-200/30');
      }
    }
    
    // 工具函数：格式化Unix时间
    function formatUnixTime(unixTime) {
      const date = new Date(unixTime * 1000);
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // 工具函数：获取星期几
    function getDayName(dayIndex) {
      const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
      return days[dayIndex];
    }
    
    // 工具函数：首字母大写
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }
    
    // 工具函数：获取紫外线指数描述
    function getUvIndexDescription(index) {
      if (index <= 2) return '低';
      if (index <= 5) return '中等';
      if (index <= 7) return '高';
      if (index <= 10) return '很高';
      return '极高';
    }
  </script>
</body>
</html>
